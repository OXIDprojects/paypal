{% extends "page/checkout/order.html.twig" %}

{% block shippingAndPayment %}
    {% set payment = oView.getPayment() %}
    {% if payment.getId() in ['oscpaypal_acdc', 'oscpaypal_pui', 'oscpaypal'] or vaultedPaymentDescription %}
        {% set sPaymentID = payment.getId() %}
        <form action="{{ oViewConf.getSslSelfLink()|replace({'&amp;': '&'})|raw }}" method="post"
              id="orderShipping">
            {{ oViewConf.getHiddenSid()|raw }}
            <input type="hidden" name="cl" value="payment">
            <input type="hidden" name="fnc" value="">
            <h4 class="card-header card-title card-header-edit d-flex justify-content-between align-items-center">
                {{ translate({ ident: "SHIPPING_CARRIER" }) }}
                <button type="submit" class="btn"
                        title="{{ translate({ ident: "EDIT" }) }}">
                    <svg aria-hidden="true">
                        <use xlink:href="#pencil"></use>
                    </svg>
                </button>
            </h4>
            {% set oShipSet = oView.getShipSet() %}
            <div class="card-body">
                {{ oShipSet.oxdeliveryset__oxtitle.value }}
            </div>
        </form>
        <form action="{{ oViewConf.getSslSelfLink()|replace({'&amp;': '&'})|raw }}" method="post"
              id="orderPayment">
            {{ oViewConf.getHiddenSid()|raw }}
            <input type="hidden" name="cl" value="payment">
            <input type="hidden" name="fnc" value="">
            <h4 class="card-header card-title card-header-edit d-flex justify-content-between align-items-center">
                {{ translate({ ident: "PAYMENT_METHOD" }) }}
                <button type="submit" class="btn"
                        title="{{ translate({ ident: "EDIT" }) }}">
                    <svg aria-hidden="true">
                        <use xlink:href="#pencil"></use>
                    </svg>
                </button>
            </h4>
        </form>
        <div class="card-body">
            {% set payment = oView.getPayment() %}
            {% if vaultedPaymentDescription %}
                {{ vaultedPaymentDescription }}
            {% elseif not oscpaypal_executing_order %}
                {{ payment.oxpayments__oxdesc.value }}
                {% if sPaymentID == "oscpaypal_acdc" %}
                    {% include "@osc_paypal/frontend/acdc.html.twig" %}
                {% elseif sPaymentID == "oscpaypal_pui" %}
                    {% include "@osc_paypal/frontend/pui.html.twig" %}
                {% elseif sPaymentID == "oscpaypal" %}
                    {% include "@osc_paypal/frontend/paypal.html.twig" %}
                {% endif %}
            {% endif %}
        </div>
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block checkout_order_next_step_side %}
    {% set payment = oView.getPayment() %}
    {% set paymentId = oView.getPayment().getId() %}
    {% if paymentId == "oscpaypal_googlepay" %}
        {# google pay has a specific button #}
        {% include "@osc_paypal/frontend/googlepay_button.html.twig" %}
    {% elseif paymentId == "oscpaypal_apple_pay"%}
        {# apple pay has a specific button #}
        {% include "@osc_paypal/frontend/applepay_button.html.twig" with {paymentId: payment.getId()} %}
    {% else %}
        {# usual order button #}
        <button id="orderSubmitButton" type="button" class="btn btn-highlight btn-lg w-100">
            {{ translate({ ident: "SUBMIT_ORDER" }) }}
        </button>

        {% capture assign = "oscpaypal_madClickPrevention" %}
            const submitButton = document.getElementById('orderSubmitButton');
            const orderConfirmAgbBottom = document.getElementById('orderConfirmAgbBottom');

            submitButton.addEventListener('click', function(event) {
            event.preventDefault();
            this.disabled = true;
            orderConfirmAgbBottom.submit();
            });
        {% endcapture %}
        {{ script({ add: oscpaypal_madClickPrevention, dynamic: __oxid_include_dynamic }) }}

    {% endif %}
{% endblock %}
