window.OxidPayPal={sdkLoaded:!1,onSDKLoaded:function(){this.sdkLoaded=!0},isSDKLoaded:function(){return this.sdkLoaded}},window.OxidPayPalGooglePay={baseRequest:{apiVersion:2,apiVersionMinor:0},paymentsClient:null,allowedPaymentMethods:null,merchantInfo:null,googlePayContainer:null,buttonId:null,token:null,selfLink:null,useGooglePayAddress:null,isSandbox:null,merchantName:null,totalPrice:null,currency:null,deliveryAddressMD5:null,language:null,loadingContainer:null,init:async function(){var e;this.googlePayContainer=document.getElementById("oscpaypal_googlepay"),this.googlePayContainer&&(this.buttonId=this.googlePayContainer.dataset.buttonId,this.token=this.googlePayContainer.dataset.token,this.selfLink=this.googlePayContainer.dataset.selfLink,this.useGooglePayAddress=!!Number(this.googlePayContainer.dataset.useGooglePayAddress),this.isSandbox=!!Number(this.googlePayContainer.dataset.isSandbox),this.merchantName=this.googlePayContainer.dataset.merchantName,this.totalPrice=this.googlePayContainer.dataset.totalPrice,this.currency=this.googlePayContainer.dataset.currency,this.deliveryAddressMD5=this.googlePayContainer.dataset.deliveryAddressMd5,this.language=this.googlePayContainer.dataset.language,e=document.getElementsByClassName(this.googlePayContainer.dataset.loadingContainerClassName),this.loadingContainer=e[0],await window.googlePayReady,this.onGooglePayLoaded())},getGoogleIsReadyToPayRequest:function(e){return Object.assign({},this.baseRequest,{allowedPaymentMethods:e})},getGooglePayConfig:async function(){var e;return null!=this.allowedPaymentMethods&&null!=this.merchantInfo||(e=await paypal.Googlepay().config(),this.allowedPaymentMethods=e.allowedPaymentMethods,this.merchantInfo=e.merchantInfo,this.merchantInfo.merchantName=this.merchantName),{allowedPaymentMethods:this.allowedPaymentMethods,merchantInfo:this.merchantInfo}},getGooglePaymentDataRequest:async function(){const e=Object.assign({},this.baseRequest);var{allowedPaymentMethods:t,merchantInfo:a}=await this.getGooglePayConfig();return e.transactionInfo=this.getGoogleTransactionInfo(),e.allowedPaymentMethods=t,e.merchantInfo=a,e.callbackIntents=["PAYMENT_AUTHORIZATION"],e.emailRequired=!0,e.shippingAddressRequired=this.useGooglePayAddress,e.shippingAddressParameters={phoneNumberRequired:!0},e},onPaymentAuthorized:function(a){return new Promise(function(t,e){this.processPayment(a).then(function(e){t({transactionState:"SUCCESS"})}).catch(function(e){t({transactionState:"ERROR"})})}.bind(this))},getGooglePaymentsClient:function(){return null===this.paymentsClient&&(this.paymentsClient=new google.payments.api.PaymentsClient({environment:this.isSandbox?"TEST":"PRODUCTION",paymentDataCallbacks:{onPaymentAuthorized:this.onPaymentAuthorized.bind(this)}})),this.paymentsClient},onGooglePayLoaded:async function(){if(window.OxidPayPal&&window.OxidPayPal.isSDKLoaded()){const t=this.getGooglePaymentsClient();var e=(await this.getGooglePayConfig())["allowedPaymentMethods"];t.isReadyToPay(this.getGoogleIsReadyToPayRequest(e)).then(function(e){e.result&&(this.loadingContainer.style.display="none",this.addGooglePayButton())}.bind(this)).catch(function(e){console.error(e)})}else window.setTimeout(this.onGooglePayLoaded.bind(this),500)},addGooglePayButton:function(){const e=this.getGooglePaymentsClient();var t=e.createButton({buttonType:"buy",buttonLocale:this.language,onClick:this.onGooglePaymentButtonClicked.bind(this)});document.getElementById("oscpaypal_googlepay").appendChild(t)},getGoogleTransactionInfo:function(){return{currencyCode:this.currency,totalPriceStatus:"FINAL",totalPrice:this.totalPrice,totalPriceLabel:"Total"}},onGooglePaymentButtonClicked:async function(){const e=await this.getGooglePaymentDataRequest(),t=(e.transactionInfo=this.getGoogleTransactionInfo(),this.getGooglePaymentsClient());t.loadPaymentData(e)},processPayment:async function(e){try{var t=this.selfLink+"&cl=oscpaypalproxy&fnc=createGooglepayOrder&paymentid=oscpaypal_googlepay&context=continue&stoken="+this.token,{id:a,status:n,links:o}=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json());const s=new OxidPayPalHateoasLinks;var i=s.getApproveLink(o);if(i)window.location.href=i;else{if("APPROVED"===n)return this.captureOrder(a),{transactionState:"SUCCESS"};if("PAYER_ACTION_REQUIRED"!==n)return console.error("Payment was not approved"),{transactionState:"ERROR"};console.log("==== Confirm Payment Completed Payer Action Required ====="),this.googlePayUserActionRequired(a)}}catch(e){return{transactionState:"ERROR",error:{message:e.message}}}},googlePayUserActionRequired:function(e){paypal.Googlepay().initiatePayerAction({orderId:e}).then(async()=>{console.log("===== Payer Action Completed ====="),await this.createOxidOrder(e)})},createOxidOrder:async function(e){var t=this.selfLink+"&cl=order&fnc=createGooglePayOrder&context=continue&stoken="+this.token+"&sDeliveryAddressMD5="+this.deliveryAddressMD5;(createData=new FormData).append("orderID",e),fetch(t,{method:"POST",body:createData}).then(function(e){return e.json()}).then(function(e){"ERROR"===e.status&&location.reload()})},captureOrder:async function(e){(captureData=new FormData).append("orderID",e);await fetch(this.selfLink+"&cl=order&fnc=captureGooglePayOrder&context=continue&stoken="+this.token+"&sDeliveryAddressMD5="+this.deliveryAddressMD5,{method:"post",body:captureData}).then(function(e){return e.json()}).then(function(e){console.log("==== Capture Order Completed ====");var t=Array.isArray(e.location)&&e.location[0];window.location.href=this.selfLink+t,"ERROR"===e.status&&location.reload()}.bind(this)).catch(e=>{console.error(e)})}},OxidPayPalGooglePay.init(),window.OxidPayPalGooglePay3DS={handle:async e=>{var t={...await window.OxidPayPalGooglePay.getGooglePaymentDataRequest(),paymentData:{tokenizationData:{type:"PAYMENT_GATEWAY",token:e.id},threeDSData:{authenticationParameters:{threeDSRequestData:{threeDSServerTransID:generateTransactionId(),challengeWindowSize:"03",messageCategory:"PAYMENT_AUTHENTICATION"}}}}};try{await paymentClient.loadPaymentData(t);if((await fetch("/v2/checkout/orders/"+e.id,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify([{op:"replace",path:"/payment_source/google_pay/card/authentication_result",value:{liability_shift:"POSSIBLE",three_d_secure:{authentication_status:"Y",enrollment_status:"Y"}}}])})).ok)return await fetch(`/v2/checkout/orders/${e.id}/capture`,{method:"POST"})}catch(e){throw console.error("3DS Authentication failed:",e),e}}},function(){"use strict";function e(){}e.prototype.getApproveLink=function(e){e=e.find(e=>"approve"===e.rel);return e?e.href:null},window.OxidPayPalHateoasLinks=e}();